<!DOCTYPE html>
<html lang="nl">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <link rel="stylesheet" href="/static/exolve/exolve-m.css">
  <script src="/static/exolve/exolve-m.js"></script>

  <!-- Socket.IO -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.5.0/socket.io.min.js"></script>
  <script>
  /* 1 ️⃣  Clear every Exolve save-slot */
  Object.keys(localStorage).forEach(k => {
    if (k.startsWith('xlvstate:') || k.startsWith('exolve-')) {
      localStorage.removeItem(k);
    }
  });

  /* 2 ️⃣  Stop Exolve from writing (or reading) again */
  if (window.Exolve) {
    Exolve.prototype.saveGameState    = function () {};
    Exolve.prototype.restoreGameState = function () {};
  }
</script>
  <script>
    const socket = io("http://localhost:5006");
    socket.on("connect",      ()  => console.log("✅ socket id =", socket.id));
    socket.on("connect_error", err => console.error("❌ socket error", err));
  </script>

  <title>Themawoord Crossword</title>
</head>
<body>

<script>
/* ---------- helpers to build a snapshot -------------------------- */
function buildAcrossMap(puz) {
  const across = {};
  for (let r = 0; r < puz.gridHeight; r++) {
    let label = null;
    for (let c = 0; c < puz.gridWidth; c++) {
      const cell = puz.grid[r][c];
      if (cell.isLight && (c === 0 || !puz.grid[r][c-1].isLight)) {
        label = cell.acrossClueLabel;
        across[label] = '';
      }
      if (cell.isLight && label) {
        across[label] += (cell.currLetter || '.');
      }
    }
  }
  return across;
}

function buildDownMap(puz) {
  const down = {};
  for (let c = 0; c < puz.gridWidth; c++) {
    let label = null;
    for (let r = 0; r < puz.gridHeight; r++) {
      const cell = puz.grid[r][c];
      if (cell.isLight && (r === 0 || !puz.grid[r-1][c].isLight)) {
        label = cell.downClueLabel;
        down[label] = '';
      }
      if (cell.isLight && label) {
        down[label] += (cell.currLetter || '.');
      }
    }
  }
  return down;
}

function emitGameState(puz) {
  const inGrid =
    puz.currRow >= 0 && puz.currRow < puz.gridHeight &&
    puz.currCol >= 0 && puz.currCol < puz.gridWidth;

  const clueLabel = inGrid
      ? (puz.currDir === 'A'
          ? puz.grid[puz.currRow][puz.currCol].acrossClueLabel
          : puz.grid[puz.currRow][puz.currCol].downClueLabel)
      : null;

  const payload = {
    across: buildAcrossMap(puz),
    down:   buildDownMap(puz),
    current_cell: { row: puz.currRow, col: puz.currCol, dir: puz.currDir },
    clue_context: { direction: puz.currDir, clueLabel }
  };

  console.log("[BROWSER] sending game_state", performance.now().toFixed(1));
  socket.emit("game_state", payload);
}

/* ---------- Exolve hook ----------------------------------------- */
function customizeExolve(puz) {
  /* ---- wipe saved crossword state every load ---- */
  Object.keys(localStorage).forEach(k => {
    if (k.startsWith("exolve-")) {
      localStorage.removeItem(k);
    }
  });
  /* prevent Exolve from saving again during this session */
  if (puz.saveGameState) {
    puz.saveGameState = () => {};
  }

  /* respond only when Python explicitly asks */
  socket.on("request_state", () => {
    console.log("[BROWSER] request_state received", performance.now().toFixed(1));
    emitGameState(puz);
  });
}
</script>

 </exolve-grid>
 <script>
   createExolve(`
  exolve-begin
  exolve-title: Mystery Country Crossword
  exolve-width: 15
  exolve-height: 15
  

  # Grid (letters are pre-filled, “.” = black square)
  exolve-grid:
..........F....
..AUSTRIA.R...M
....P....PANAMA
TAIWAN....N...L
....I...I.C.K.A
.CHINA.GREECE.Y
...R....A...N.S
..VATICANCITY.I
.I.Q..A..Z..A.A
.S....N..E.....
.RUSSIA..CHILE.
.A.Y..D..H.T.G.
.E.R.HAITI.A.Y.
.L.I.....A.L.P.
..JAMAICA..Y.T.

    
  exolve-across:
  2 Country famous for Mozart and the Alps
  5 Country whose canal connects the Atlantic and Pacific oceans
  6 Island whose capital is Taipei
  9 Eastern land known for a monumental divide
  11 Where Plato and Socrates once strolled
  12 Smallest country in the world, home to St. Peter’s Basilica
  16 Country that stretches from Europe to Asia 
  18 South American country named like a pepper, with Santiago as its capital 
  21 Caribbean country hit by a major earthquake in 2010
  22 Home of Usain Bolt and reggae music

  exolve-down:
  1 Country whose motto is Liberté, Égalité, Fraternité
  3 European country whose capital is Madrid, famous for paella
  4 Country whose capital is Kuala Lumpur
  7 Country whose capital is Tehran and was once called Persia
  8 East African country whose capital is Nairobi
  10 Country whose capital is Baghdad, located between the Tigris and Euphrates
  13 Country north of the United States known for maple syrup
  14 Central European country whose capital is Prague, formerly part of Czechoslovakia
  15 Middle Eastern country founded in 1948, capital Jerusalem
  17 Country whose ancient city of Damascus is one of the oldest continually inhabited
  19 European country shaped like a boot, capital Rome
  20 African country whose ancient monuments include the Pyramids of Giza
  exolve-end
  `);
</script>
</body>
</html>

<!--
21 countries
AUSTRIA, CANADA, CHILE, CHINA, CZECHIA, EGYPT, FRANCE, GREECE, HAITI, IRAN, IRAQ, ISRAEL, ITALY, JAMAICA, KENYA, MALAYSIA, PANAMA, RUSSIA, SPAIN, SYRIA, TAIWAN, VATICANCITY
  -->
